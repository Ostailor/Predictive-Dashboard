{% extends "base.html" %}

{% block title %}{{ title }} - Predictive Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>{{ title }}</h2>
    <p>Upload a sales data CSV file to import into the database. The CSV should have columns: 'date', 'store', 'item', 'sales'.</p>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST" enctype="multipart/form-data" action="{{ url_for('main.data_management') }}">
        <div class="form-group">
            <label for="sales_csv">Select CSV File:</label>
            <input type="file" class="form-control-file" id="sales_csv" name="sales_csv" accept=".csv" required>
        </div>
        <button type="submit" class="btn btn-primary mt-2">Upload and Import</button>
    </form>

    <hr class="my-4"> {# Added margin for better separation #}

    <h4>Model Management</h4>
    <p>You can manually retrain the primary sales forecasting model (Random Forest for all stores/items). This is recommended after uploading new sales data.</p>
    <form method="POST" action="{{ url_for('main.trigger_rf_retrain') }}">
        <button type="submit" class="btn btn-warning">Retrain Global Sales Model</button>
    </form>
    
    <hr class="my-4"> {# Added margin #}
    <p><a href="{{ url_for('main.sales_overview') }}">Back to Sales Overview</a></p>
</div>
{% endblock %}